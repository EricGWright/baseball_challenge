<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Beer League Baseball Challenge</title>

  <!-- css files -->
  <link href="css/bootstrap.min.css" type="text/css" rel="stylesheet" />
  <link href="css/bootstrap-responsive.min.css" type="text/css" rel="stylesheet" />
  <link href="css/styles.css" type="text/css" rel="stylesheet" />

  <!-- js files -->
  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/schedule.js"></script>

  <script type="text/javascript">
  $(document).ready(function() {

// ******************* declare variables ************************

    // define min and max number of teams
    var minTeams = 4;
    var maxTeams = 8;

    // create empty team array
    var league = new Array();

// ******************** get league data *************************

    // retrieve league data from server
    $.ajax({
      url: '/backliftapp/team',
      type: "GET",
      dataType: "JSON",
      success: function (data) {

        // fill league array with data
        league = data;

        // populate standings table
        for (var i = 0; i < league.length; i++) {
          $("#standings tbody").append("<tr><th>"  + (i+1) + "</th><td>" + league[i].teamName + "</td><td>" + league[i].wins + "</td><td>" + league[i].losses + "</td><td>" + league[i].percentage + "</td><td><button class='btn btn-danger btn-mini delete' type='button'>Delete</button></td></tr>");
        };

        // make delete buttons functional
        deleteTeam();

        // populate schedule table
        updateSchedule();

      }
    }); // end GET

// *********** create new team / update standings ************

    // click event on team form submit button
    $("#createTeam").click(function() {

      // show alert message if too many teams
      if (league.length == maxTeams) {
        $("#formAlert").show();
        $("#teamForm input").val("");
        return;
      };

      // hide alert when dismissed
      $("#alertClose").click(function() {
        $("#formAlert").hide();
      });

      // send team data to server
      $.ajax({
        url: '/backliftapp/team',
        type: "POST",
        dataType: "JSON",
        data: {
        teamName: $("#teamName").val(),
        firstName: $("#firstName").val(),
        lastName: $("#lastName").val(),
        phone: $("#phone").val(),
        sponsor: $("#sponsor").val(),
        zip: $("#zip").val(),
        wins: 0,
        losses: 0,
        percentage: 0
        },
        success: function (data) {

          // update league array
          league.push(data);

          // clear the standings table
          $("#standings tbody").html("");

          // update standings table
          for (var i = 0; i < league.length; i++) {
            $("#standings tbody").append("<tr><th>"  + (i+1) + "</th><td>" + league[i].teamName + "</td><td>" + league[i].wins + "</td><td>" + league[i].losses + "</td><td>" + league[i].percentage + "</td><td><button class='btn btn-danger btn-mini delete' type='button'>Delete</button></td></tr>");
          };

          // make delete buttons functional
          deleteTeam();

          // update schedule table
          updateSchedule();

        }
      }); // end POST

      // clear team form inputs
      $("#teamForm input").val("");

    }); // end click

// ******************** update schedule *************************

    function updateSchedule() {

      // determine schedule length
      var schedule;
      if (league.length == 4 || league.length == 5) {
        schedule = sched4;
      } else if (league.length == 6 || league.length == 7) {
        schedule = sched6;
      } else if (league.length == 8) {
        schedule = sched8;
      };

      // verify league has enough teams
      if (league.length >= minTeams) {

        // clear the schedule table
        $("#schedule ul").html("");
        $("#schedule .tab-content").html("");

        // create tabs and panes
        for (var i = 0; i < (schedule.length); i++) {
          $("#schedule ul").append("<li><a href='#week" + (i + 1) + "' " + "data-toggle='tab'>Week " + (i + 1) + "</a></li>");
          $("#schedule .tab-content").append("<div id='week" + (i + 1) + "' " + "class='tab-pane'><table class='table table-striped'><thead><tr><th>Teams</th><th>Final Score</th></tr></thead><tbody></tbody></table></div>");

          // write data to appropriate panes
          for (var j = 0; j < schedule[i].length; j++) {
            var home = schedule[i][j][0];
            var away = schedule[i][j][1];
            $("#week" + (i + 1) + " tbody").append("<tr><td>" + home + " vs. " + away + "</td><td>" + "Score!" + "</td></tr>");
          };

        }; // end for loop

        // make week 1 tab active
        $("#schedule li:first-child").addClass("active");
        $("#week1").addClass("active");
      
      }; // end if statment

    }; // end updateSchedule

// *************** make delete button functional ****************

    function deleteTeam() {

      // click event on delete buttons
      $(".delete").on("click", function() {

        // delete team data from server
        $.ajax({
          url: "/backliftapp/team/" + league[0].id,
          type: "DELETE",
          dataType: "JSON",
          success: function () {
            
            // remove team from league array
            league.shift();

            // clear the standings table
            $("#standings tbody").html("");

            // populate standings table
            for (var i = 0; i < league.length; i++) {
              $("#standings tbody").append("<tr><th>"  + (i+1) + "</th><td>" + league[i].teamName + "</td><td>" + league[i].wins + "</td><td>" + league[i].losses + "</td><td>" + league[i].percentage + "</td><td><button class='btn btn-danger btn-mini delete' type='button'>Delete</button></td></tr>");
            };

            // make new delete buttons functional
            deleteTeam();

          }
        }); // end DELETE

      }); // end click

    }; // end deleteTeam

// ********************* form validation **********************

    // enter form validation here



  }); // end ready
  </script>
</head>
<body>

  <!-- navbar -->
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <ul class="nav">
          <li><a href="#teamModal" data-toggle="modal">Create Team</a></li>
          <li><a href="#scoreModal" data-toggle="modal">Report Score</a></li>
        </ul>
        <a id="title" class="brand pull-right" href="#">Beer League Baseball Challenge</a>
      </div>
    </div>
  </div>

  <div id="mainContent" class="container">

    <!-- alert message -->
    <div class="row-fluid">
      <div id="formAlert" class="alert alert-error span12">
        <button id="alertClose" class="close" type="button">&times;</button>
        Sorry, this league already has 8 teams!
      </div>
    </div>

    <div class="row-fluid">

      <!-- standings -->
      <div id="standings" class="span5">
        <h3>Standings</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Team</th>
              <th>Wins</th>
              <th>Losses</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>

      <!-- schedule/results -->
      <div id="schedule" class="span7">
        <h3>Schedule</h3>
        <div class="tabbable tabs-left">
          <!-- default tab -->
          <ul class="nav nav-tabs">
            <li class="active"><a href="#week1" data-toggle="tab">Week 1</a></li>
          </ul>
          <div class="tab-content">
            <!-- default pane -->
            <div id="week1" class="tab-pane active">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Teams</th>
                    <th>Final Score</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div><!-- end .tab-content -->
        </div><!-- end .tabbable -->
      </div><!-- end .span6 -->

    </div><!-- end .row-fluid -->

  <!-- team form modal -->
  <div id="teamModal" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Team Information</h3>
    </div>
    <div class="modal-body">
      <form id="teamForm" class="form-horizontal">
        <div class="control-group">
          <label class="control-label" for="teamName">Team Name</label>
          <div class="controls">
            <input id="teamName" type="text" name="teamName" placeholder="Ex. Milwaukee Beers" />
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="firstName">Manager's First Name</label>
          <div class="controls">
            <input id="firstName" type="text" name="firstName" placeholder="Ex. Joe" />
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="lastName">Manager's Last Name</label>
          <div class="controls">
            <input id="lastName" type="text" name="lastName" placeholder="Ex. Cooper" />
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="phone">Phone Number</label>
          <div class="controls">
            <input id="phone" type="text" name="phone" placeholder="Ex. 555-555-BEER" />
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="sponsor">Team Sponsor</label>
          <div class="controls">
            <input id="sponsor" type="text" name="sponsor" placeholder="Ex. Milwaukee's Best" />
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="zip">Zip Code</label>
          <div class="controls">
            <input id="zip" type="text" name="zip" placeholder="Ex. 53201" />
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button id="createTeam" class="btn btn-primary" type="submit" data-dismiss="modal" aria-hidden="true">Submit</button>
    </div>
  </div><!-- end #teamModal -->

  <!-- score form modal -->
  <div id="scoreModal" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Report Score</h3>
    </div>
    <div class="modal-body">
      <form id="teamForm" class="form-horizontal">
        <div class="control-group">
          <label class="control-label" for="teamName">Team Name</label>
          <div class="controls">
            <input id="teamName" type="text" name="teamName" placeholder="Ex. Milwaukee Beers" />
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button id="createTeam" class="btn btn-primary" type="submit" data-dismiss="modal" aria-hidden="true">Submit</button>
    </div>
  </div><!-- end #scoreModal -->

  </div><!-- end .container -->
</body>
</html>